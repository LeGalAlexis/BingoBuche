<html>
    <head>
        <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
        <link rel="stylesheet" type="text/css" href="./style.css" />
        <script src="https://kit.fontawesome.com/92c9b58fa8.js" crossorigin="anonymous"></script>
    </head>
    <body>
        <div class="page">
            <div class="container">
                <div class="cell cell-0">test</div>
                <div class="cell cell-1">test</div>
                <div class="cell cell-2">test</div>
                <div class="cell cell-3">test</div>
                <div class="cell cell-4">test</div>
                <div class="cell cell-5">test</div>
                <div class="cell cell-6">test</div>
                <div class="cell cell-7">test</div>
                <div class="cell cell-8">test</div>
                <div class="cell cell-9">test</div>
                <div class="cell cell-10">test</div>
                <div class="cell cell-11">test</div>
                <div class="cell cell-12">test</div>
                <div class="cell cell-13">test</div>
                <div class="cell cell-14">test</div>
                <div class="cell cell-15">test</div>
                <div class="cell cell-16">test</div>
                <div class="cell cell-17">test</div>
                <div class="cell cell-18">test</div>
                <div class="cell cell-19">test</div>
                <div class="cell cell-20">test</div>
                <div class="cell cell-21">test</div>
                <div class="cell cell-22">test</div>
                <div class="cell cell-23">test</div>
                <div class="cell cell-24">test</div>
            </div>
            <div class="side-panel">
                <h1 class="title">Bingo Buche !</h1>
                <p><img src="./wazotest2_112px.png" alt="wazo" class="wazo" ></p>
                <button onClick="window.location.reload();">Creer un nouveau bingo</button>
            </div>
        </div>
        <div id="bingo" class="hidden">
            <div class="bingo-title"><img src="./bubuchenewsub.gif"><span class="rotating"><span class="bingo-txt">BINGO !!!</span><button onclick="continueBingo()">Continuer</button></span><img src="./bubuchenewsub.gif"></div>
        </div>
        
        <script>
            var interval;
            var hasAnimationBeenTriggered = false;
            const cells = ["ça ken SALE", 
                "musique trop épique", 
                "animal en voie de disparition",
                "timelapse nuages",
                "combat contre les éléments",
                "slowmo inutile",
                "\"La nature reprend ses droits\"",
                "entre tradition & modernité/terre de contrastes etc",
                "baston pour la dominance",
                "parade nuptiale chelou",
                "bébé animal mignon",
                "plan drone",
                "licence poétique approximative",
                "harmonie / osmose",
                "sound designer en roue libre",
                "3D éclatée",
                "sous titres inventent des applaudissements",
                "l'eau, bien le plus précieux",
                "écotourisme",
                "le problème c'est nous",
                "animal mignon se fait manger par un prédateur",
                "métaphore filée claquée au sol",
                "\"nature impitoyable\"",
                "gros plan carcasse"];

            function shuffle(array) {
                let currentIndex = array.length,  randomIndex;

                // Tant qu'il reste des éléments à mélanger...
                while (currentIndex != 0) {

                    // Prendre un élément au hasard...
                    randomIndex = Math.floor(Math.random() * currentIndex);
                    currentIndex--;

                    // Et l'échanger avec l'element actuel.
                    [array[currentIndex], array[randomIndex]] = [
                    array[randomIndex], array[currentIndex]];
                }

                return array;
            }

            function setCell(item, index, arr) {
                $(".cell-"+ index).text(item)
            }

            function setGrid() {
                let gridCells = [...cells];
                shuffle(gridCells);
                gridCells.splice(12, 0, "FREE SPACE");
                gridCells.forEach(setCell);
            }

            function isSelected(index) {
                return $(".cell-"+ index).hasClass("selected")
            }

            function makeItRain() {
                if(!hasAnimationBeenTriggered) {
                    interval = self.setInterval(function(){addRandomImage()},50);
                    $("#bingo").removeClass("hidden");
                    hasAnimationBeenTriggered = true;
                }
            }

            const images = ["buchehap112px.png", "mims2.png", "pipe112px.png", "wazotest2_112px.png" ]
            function addRandomImage() {
                let rngImg = Math.floor((Math.random() * 4));
                let rngX = Math.floor((Math.random() * ($(window).width() - 91)));
                let rngY = Math.floor((Math.random() * ($(window).height() - 91)));
                $( "#bingo" ).append(`<img src="./${images[rngImg]}" style="top: ${rngY}px;left: ${rngX}px;" class="floating pop">`);
            }

            function checkLine(indexesToCheck) {
                if(indexesToCheck.every(isSelected)) {
                    indexesToCheck.forEach((item, index, arr) => $(".cell-"+ item).addClass('bingo'))
                    makeItRain();
                }
            }

            function continueBingo() {
                clearInterval(interval);
                $("#bingo").addClass("hidden")
            }

            $( document ).ready(function() {
                setGrid();
            });

            $(".cell").click(function() {
                $(this).toggleClass('selected');
                checkLine([0,1,2,3,4]);
                checkLine([5,6,7,8,9]);
                checkLine([10,11,12,13,14]);
                checkLine([15,16,17,18,19]);
                checkLine([20,21,22,23,24]);

                checkLine([0,5,10,15,20]);
                checkLine([1,6,11,16,21]);
                checkLine([2,7,12,17,22]);
                checkLine([3,8,13,18,23]);
                checkLine([4,9,14,19,24]);

                checkLine([0,6,12,18,24]);
                checkLine([4,8,12,16,20]);
            });
        </script>
    </body>
</html>